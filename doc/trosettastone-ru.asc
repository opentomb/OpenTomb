Устройство Tomb Raider (TRosettaStone)
======================================
:doctype: book
:toc2:
:numbered:
:latexmath:
:icons:
:source-highlighter: pygments
:imagesdir: images

:TR1: image:images/icons/tr1.png[title="TR1 only",alt="TR1 only",height=17,width=16]
:TR2: image:images/icons/tr2.png[title="TR2 only",alt="TR2 only",height=17,width=16]
:TR3: image:images/icons/tr3.png[title="TR3 only",alt="TR3 only",height=17,width=16]
:TR4: image:images/icons/tr4.png[title="TR4 only",alt="TR4 only",height=17,width=16]
:TR5: image:images/icons/tr5.png[title="TR5 only",alt="TR5 only",height=17,width=16]

[width="100%",cols="99%,>1%",frame="none",grid="none",valign="middle",style="asciidoc"]
|====
|
*Версия документа: 3.00 (последний раз отредактировано: {localdate})*

Включает в себя информацию об Tomb Raider `.PHD/.TUB`, Tomb Raider II-III `.TR2`, Tomb Raider IV `.TR4` файлах и Tomb Raider Chronicles (V) `.TRC` файлах, если таковая информация имеется.

Также включает в себя информацию о `TOMBPC.DAT` скриптах, `CDAUDIO.WAD` и `CUTSEQ.PAK` файлах.
|
image:images/logo/trosej-mid.png[]
|====

Введение
--------

До сих пор сообщество Tomb Raider, главным образом программисты и энтузиасты моддеры, ссылались на документ под названием 'TRosettaStone', который не обновлялся с 1999 года, и его пересмотренный вариант (мы назвали его 'TRosettaStone 2'), который был выполнен E. Поповым (E. Popov) в 2000 или 2001 году. Оба этих документа, помогавших в свое время, страдали от многих ошибок и неточностей.

Многие люди нашли эти ошибки и неточности, но никто из них не переделал существующей документации, сохраняя все свои знания только в своей голове. Общеизвестно, что оригиналу не хватает некоторой информации то здесь, то там, и что-то неправильно описано -- но это нигде не упоминается (за исключением некоторых потерянных сообщений на форумах). Так что, когда новичок начинает программировать, он должен наступить на те же грабли, что и все остальные.

[quote]
``Такого быть не должно.''

Цель 'TRosettaStone 3' заключается в замене оригинального документа и служить в качестве всеобъемлющего источника информации для тех, кто готов участвовать в разработке программного обеспечения для Tomb Raider. Мы будем использовать оригинальную TRosettaStone в качестве основы, в значительной степени заимствования из переиздания Е. Попова. Кроме того, этот документ будет широко заимствовать информацию из руководства пользователей TREP, инструкции, NGLE и информацию с кучи тем форумов и сообщений, касающихся внутренней структуры движка игры.

Тем не менее, в то время как оригинальный TRosettaStone и обновление Попова были направлены в первую очередь на изучение уже существующих игровых активов, такие как уровни, звуковые файлы, скрипты и т.д., этот документ создается в общем и в качестве эталона для программистов, создающих повторно игровые движки с открытым исходным кодом. Из-за этого мы иногда будем исследовать не только форматы файлов игры, но и внутреннюю логику игры, процедуры и другие связанные аспекты. Этот документ будет обновляться синхронно с развитием 'OpenTomb', одним из таких повторных проектов, который получил много отзывов от сообщества.

Описание
~~~~~~~~

Этот документ содержит подробные описания форматов файлов данных оригинальной Tomb Raider. Предполагается, что читатель имеет знания и опыт программирования на C или C++ и имеет, по меньшей мере, общее знакомство с графическим программированием. Этот документ является автономным; все гиперссылки ссылаются только на документ.

Вся информация в этом документе, была получена самостоятельно, без помощи или оказания поддержки любого из Core Design или Eidos. Таким образом, в этом документе информация может содержать ошибки или упущения, а многие структуры и имена переменных были выведены из интерпретации данных (и, следовательно, может ввести в заблуждение или совершенно неправильно быть истолковано). Тем не менее, мы вновь используем определенные имена переменных и функций отличных от оригинальной отладочной сборки Tomb Raider и таблицы символов из просочившейся Tomb Raider Chronicles PSX SDK.

Вся информация в этом документе была проверена и, следовательно, правдоподобна, но также может быть неверно истолкована. Вся информация в настоящем документе, предоставляется как есть -- вы получаете ровно столько, сколько платите, получаете свободно. Это свободный проект, который намерен документировать форматы файлов Tomb Raider.

Условности
~~~~~~~~~~

Вообще, версии игры используют сокращения:

* *TR1* сокращение для Tomb Raider и Tomb Raider: Unfinished Business
* *TR2* сокращение для Tomb Raider II и Tomb Raider: The Golden Mask
* *TR3* сокращение для Tomb Raider III и Tomb Raider: The Lost Artifact
* *TR4* сокращение для Tomb Raider: The Last Revelation
* *TR5* сокращение для Tomb Raider: Chronicles

[NOTE]
====
Форматы уровня *TR4* относятся не только к оригинальной игре, но и к 'пользовательским уровням' собранными фанатами с помощью 'Tomb Raider Level Editor' (`winroomedit.exe`) версии `.49`, используемого для работы с TR4-специфичными файлами уровней. Эта версия редактора единственный редактор официально выпущенный Eidos / Core, наряду с TR5.
====

Когда мы приводим некоторую зависимую от версий информацию о некоторых структурах или методах, эта информация будет помечена специальными изображениями, обозначающими версию игры этими картинками: {TR1} для TR1, {TR2} для TR2, {TR3} для TR3, {TR4} для TR4, и {TR5} для TR5. Версия-зависимая информация будет продолжена до следующего параграфа или списка записи, пока не указано иное.


Кроме того, если внешние программы и утилиты участвуют, вот сокращения для них:

* *TRLE* сокращение для Tomb Raider Level Editor -- официальная утилита Core Design для изменения уровней.
* *NGLE* сокращение для TRLE версии, которая была неофициально исправлена и в настоящее время широко используется для редактирования уровней сообществом.
* *Dxtre3d* сокращение для так называемого 'неофициального' редактора уровней созданного Felix aka 'Turbo Pascal'.
* *TREP* сокращение для бинарного патчера который используется для изменения 'движка TR4' в 'редактор уровней' (в связке с TR5) для включения некоторых улучшений от сообщества.
* *TRNG* еще один патчер для тех же целей, что и  TREP, впрочем, несовместимый с ним. TRNG предоставляет более дополнительные возможности и улучшения для 'движка TR4'.
* *FLEP* сокращение для аналогичного патчера из 'TREP', который используется для того же 'движка TR4', предварительно модифицированного до 'TRNG'.

Пока не известно
~~~~~~~~~~~~~~~~

. Структура освещения комнат из TR4 требует дополнительного пояснения.
. То же самое для структуры освещения комнаты в TR5.
. Точное значение понятия "слой комнаты" в TR5.
. Уточнить значение для '4-го бита' в структуре <<tr2_room_vertex>>.
. Уточнить назначение поля `Normal` в структуре <<tr5_room_vertex>>, и действительно ли поле `Attributes` было удалено.
. Вся структура `tr5_room` нуждается в детальном анализе из за всех лишних 'Unknown' полей.
. Уточнить значения теней, влияющих на их радиус.
. Определить назначение поля ``flag/zone'' в структуре `tr_camera`.

Авторские права
~~~~~~~~~~~~~~~

Tomb Raider, Tomb Raider Gold, Unfinished Business, Tomb Raider II, Tomb Raider III, Tomb Raider: The Last Revelation, Tomb Raider Chronicles, Лара Крофт, и
все изображения и данные внутри файлов игры и игрового движка являются Авторским правом © Square Enix.

include::fundamentals.asc[tabsize=2]

include::room_geometry.asc[tabsize=2]

include::floordata.asc[tabsize=2]

include::meshes_models.asc[tabsize=2]

include::mesh_construction_animation.asc[tabsize=2]

include::npc_behaviour.asc[tabsize=2]

include::sound.asc[tabsize=2]

include::miscellany.asc[tabsize=2]

include::file_formats.asc[tabsize=2]

include::scripting_tr2_tr3.asc[tabsize=2]

include::scripting_tr4.asc[tabsize=2]

include::cutseq.asc[tabsize=2]
